$(function(){function e(){var e=!0;return 0==$("#telInput").val().length?($(".warn_tel").show(),$(".warn_tel .warn_border").html("请输入手机号码"),e=!1):11!=$("#telInput").val().length&&($("#telIcon").show(),$("#telIcon").removeClass("success"),$("#telIcon").addClass("warn"),$(".warn_tel").show(),$(".warn_tel .warn_border").html("手机号码输入有误"),e=!1),$.ajax({type:"post",url:basePath+"/user/checkphonenum",anysc:!1,data:{telephone:$("#telInput").val()},success:function(n){"0000"==n.code||"0030"==n.code?($("#telIcon").show(),$("#telIcon").removeClass("success"),$("#telIcon").addClass("warn"),$(".warn_tel .warn_border").html('手机号已注册,<a class="re_login" style="color:#0033FF" href="'+htmlbasePath+'/users/login.html">立即登录</a>'),$(".warn_tel").show(),e=!1):"0021"==n.code?($("#telIcon").show(),$("#telIcon").removeClass("success"),$("#telIcon").addClass("warn"),$(".warn_tel .warn_border").html("手机号码输入有误"),$(".warn_tel").show(),e=!1):"0023"==n.code&&($(".warn_tel").hide(),$("#telIcon").show(),$("#telIcon").addClass("success"),e=!0)}}),e}function n(){var e=$.trim($("#telInput").val()),o=$.trim($("#picture_code").val());return e?11!=e.length?($(".warn_tel .warn_border").html("请输入正确的手机号码"),$(".warn_tel").show(),!1):o?4!=o.length?($(".warn_yzm .warn_border").html("图片验证码不正确"),$(".warn_yzm").show(),!1):"block"==$(".warn_tel").css("display")?!1:"block"==$(".warn_yzm").css("display")?!1:(d=l,$.ajax({type:"POST",url:basePath+"/user/piccode",data:{telephone:e,type:"0",authCodeType:"2",pictureCode:o,confirmCode:e+o},success:function(e){if("0000"==e.code)$("#_yz").hide(),$("#busy").hide(),$("#yuYinCode").unbind("click"),$("#yuYinCode").html("("+d+"s)"),$("#yuyinText").html("请留意来电"),$("#yuYinCode").css("color","#a3a3a3"),$("#yuYinCode").css("text-decoration","none"),0==t&&null!=$("#telInput").val&&($("#_yz").hide(),$("#telInput").attr("disabled",!0)),s=window.setInterval(function(){0==d?(window.clearInterval(s),$("#yuYinCode").bind("click",n),$("#yuYinCode").css("color","#bc6a00"),$("#yuYinCode").css("text-decoration","underline"),$("#yuYinCode").html("语音验证码")):(d--,$("#yuYinCode").html("("+d+"s)"),$("#yuyinText").html("请留意来电"),$("#yuYinCode").css("color","#a3a3a3"),$("#yuYinCode").css("text-decoration","none"))},1e3);else{if("0021"==e.code)return $("#telIcon").show(),$("#telIcon").removeClass("success"),$("#telIcon").addClass("warn"),$(".warn_tel").show(),$(".warn_tel .warn_border").html("请输入手机号码"),!1;if("0044"==e.code)return $("#yzmIcon").removeClass("success"),$("#yzmIcon").addClass("warn"),$(".warn_yzm .warn_border").html("图片验证码输入有误"),$(".warn_yzm").show(),$("#picCodeSpan").html('<img src="'+basePath+"/user/createCode?t="+Math.random()+'" id="codeImg"/>'),$("#picture_code").val(""),!1;"0043"==e.code&&$("#busy").show()}}}),!1):($(".warn_yzm .warn_border").html("请输入图片验证码"),$(".warn_yzm").show(),!1):($(".warn_tel .warn_border").html("请输入手机号码"),$(".warn_tel").show(),!1)}$(":input").val(""),$("#telInput").attr("disabled",!1),$(":input").bind("keypress",function(e){return 13==e.keyCode?!1:void 0});var t;$("#telInput").on("keyup",function(){var e=/\D/g;1==e.test(this.value)&&(this.value=this.value.replace(/\D/g,"")),this.value.length>11&&(this.value=this.value.substring(0,11))}).on("focus",function(){$("#telIcon").hide(),$(".warn_tel").hide()}).on("blur",function(){e()}),$("#picture_code").bind("keyup",function(){this.value.length>4&&(this.value=this.value.substring(0,4))}).bind("focus",function(){$("#yzmIcon").hide(),$(".warn_yzm").hide()}).bind("blur",function(){0==$("#picture_code").val().length&&($(".warn_yzm .warn_border").html("请输入图片验证码"),$(".warn_yzm").show())}),$("#getPicCode").bind("click",function(){return $("#picCodeSpan").html('<img src="'+basePath+"/user/createCode?t="+Math.random()+'" id="codeImg"/>'),$("#yzmIcon").hide(),$(".warn_yzm").hide(),$("#picture_code").val(""),!1}),$("#passwordInput").bind("keyup",function(){this.value.length>32&&(this.value=this.value.substring(0,32))}).bind("focus",function(){$(".warn_pwd").hide(),$("#pswIcon").hide()}).bind("blur",function(){var e=$.trim($(this).val());return e&&e.length<6?($("#J_password_err").show(),$("#pswIcon").show(),void $("#J_password_err").find(".warn_border").html("密码长度至少6位")):void(e&&e.length>32&&($("#J_password_err").show(),$("#pswIcon").show(),$("#J_password_err").find(".warn_border").html("请设置6-32位的密码")))}),$("#repeatPassword").bind("keyup",function(){this.value.length>32&&(this.value=this.value.substring(0,32))}).bind("focus",function(){$(".warn_confirm").hide(),$("#confarmIcon").hide()}).bind("blur",function(){var e=$.trim($("#passwordInput").val()),n=$.trim($(this).val());!n&&e.length>=6&&e.length<=32?($("#pwdtips2 .warn_border").html("请输入确认密码"),$("#pwdtips2").show()):e!=n&&""!=n?($("#confarmIcon").show(),$(".warn_confirm .warn_border").html("两次密码输入不一致，请重新输入"),$(".warn_confirm").show()):e==n&&""!=n&&$(".warn_confirm").hide()}),$("#codeInput").bind("focus",function(){$("#jymIcon").hide(),$(".warn_jym").hide()}).bind("keyup",function(){var e=/\D/g;1==e.test(this.value)&&(this.value=this.value.replace(/\D/g,"")),this.value.length>6&&(this.value=this.value.substring(0,6))}).bind("blur",function(){var e=$(this).val().length;0==e?($(".warn_jym .warn_border").html("请输入短信验证码"),$(".warn_jym").show(),$("#jymIcon").addClass("warn").show()):6!=e&&($("#jymIcon").removeClass("success").addClass("warn").show(),$(".warn_jym .warn_border").html("短信验证码输入有误"),$(".warn_jym").show())});var o,r=60,a=0;$("#getCode").bind("click",function(){$("#getCode").addClass("code_get_click");var e=$.trim($("#telInput").val()),n=$.trim($("#picture_code").val());return e?11!=e.length?($(".warn_tel .warn_border").html("请输入正确的手机号码"),$(".warn_tel").show(),!1):n?4!=n.length?($(".warn_yzm .warn_border").html("图片验证码不正确"),$(".warn_yzm").show(),!1):(a=r,$.ajax({type:"POST",url:basePath+"/user/piccode",data:{telephone:e,type:"0",authCodeType:"1",pictureCode:n,confirmCode:e+n},success:function(e){if("0000"==e.code)$("#_yz").hide(),$("#busy").hide(),$("#getCode").attr("disabled","true"),$("#getCode").html(a+"s后重新发送"),$("#getCode").css("background","#f7f1e9"),$("#getCode").css("color","#867a6a"),null!=$("#telInput").val&&$("#telInput").attr("disabled",!0),o=window.setInterval(function(){0==a?(window.clearInterval(o),$("#getCode").removeAttr("disabled"),$("#getCode").css("background","#fe9711"),$("#getCode").css("color","#fff"),$("#getCode").html("重新发送")):(a--,$("#getCode").html("重新发送("+a+")"),$("#getCode").css("background","#f7f1e9"),$("#getCode").css("color","#867a6a"))},1e3);else{if("0021"==e.code)return $("#telIcon").show(),$("#telIcon").removeClass("success"),$("#telIcon").addClass("warn"),$(".warn_tel").show(),$(".warn_tel .warn_border").html("请输入手机号码"),!1;if("0044"==e.code)return $("#yzmIcon").removeClass("success"),$("#yzmIcon").addClass("warn"),$("#yzmIcon").show(),$(".warn_yzm .warn_border").html("图片验证码输入有误"),$(".warn_yzm").show(),$("#picCodeSpan").html('<img src="'+basePath+"/user/createCode?t="+Math.random()+'" id="codeImg"/>'),$("#picture_code").val(""),!1;"0043"==e.code&&$("#busy").show()}}}),!1):($(".warn_yzm .warn_border").html("请输入图片验证码"),$(".warn_yzm").show(),!1):($(".warn_tel .warn_border").html("请输入手机号码"),$(".warn_tel").show(),!1)});var s,l=60,d=0;$("#yuYinCode").bind("click",n),$("#J_gram_checkbox").on("click",function(){$(this).toggleClass("on"),$(this).hasClass("on")&&$("#agreeWarn").hide()}),$("#submitButton").bind("click",function(){var n="",t="",o="";try{n=pointman.getConfig().appkey,t=pointman.getConfig().token,o=pointman.getConfig().scene}catch(r){}if($("#submitButton").addClass("submit_click"),!e())return!1;var a=$("#passwordInput"),s=$("#J_password_err"),l=$("#repeatPassword"),d=$("#pwdtips2"),c=a.val(),i=l.val();if(c){if(c.length<6)return s.find("span").html("密码长度至少六位"),void s.show();if(c.length>32)return s.find("span").html("请设置6-32位的密码"),void s.show();if(!i)return d.find("span").html("请确认密码"),void d.show();if(i&&c!=i)return d.find("span").html("两次密码输入不一致，请重新输入"),void d.show()}else if(i)return s.find("span").html("请输入密码"),void s.show();return $("#J_gram_checkbox").hasClass("on")?($.ajax({type:"POST",url:basePath+"/user/registerForTBByValid",data:{telephone:$("#telInput").val(),authCode:$("#codeInput").val(),password:$("#passwordInput").val(),rePassword:$("#repeatPassword").val(),appKey:n,tokenId:t,sceneId:o},success:function(e){"0000"==e.code?(GB.cookie.addCookie("telephone",$("#telInput").val()),location.href=htmlbasePath+"/users/reg_3.html"):"0041"==e.code||"0021"==e.code?($("#jymIcon").show(),$("#jymIcon").removeClass("success"),$("#jymIcon").addClass("warn"),$(".warn_jym .warn_border").html("验证码输入有误"),$(".warn_jym").show()):"0042"==e.code?($("#confarmIcon").show(),$("#confarmIcon").removeClass("success"),$("#confarmIcon").addClass("warn"),$(".warn_confirm .warn_border").html("两次密码不一致"),$(".warn_confirm").show()):GB.utils.alert(e.msg)}}),!1):void $("#agreeWarn").show()})});